Identify the top 100 genes that most frequently exhibit Allele-Specific Methylation (ASM) across a population of samples. 

Given detected ASM sites across multiple biological samples `benchmark/dataset/ASMdb/mock/mock_asm_sites.csv` and genomic coordinates for all genes `benchmark/dataset/ASMdb/mock/mock_genes.csv`.

For each sample, quantified the number of ASM sites within each gene body and its $3~\mathrm{kb}$ upstream region. The frequency of genes covered by ASM was then aggregated across all samples. 

Finally, identified the top 100 genes with the highest ASM frequency, and save the result into a csv file `/root/autodl-tmp/biomni_v20260208_pred_results/doubao-seed-1-8/asmdb_annotate.csv`

Output example for reference:
gene_id,frequency
GENE_1,15
GENE_2,14
GENE_3,13
GENE_4,12
...

All intermediate code generated during execution, downloaded files, and temporary results must be stored in `/root/autodl-tmp/biomni_v20260208_tmp/doubao-seed-1-8/asmdb_annotate`

<execute>
import pandas as pd

# Read ASM sites data
asm_sites = pd.read_csv("benchmark/dataset/ASMdb/mock/mock_asm_sites.csv")
print("ASM Sites Data Head:")
print(asm_sites.head())
print("\nASM Sites Columns:", asm_sites.columns.tolist())

# Read genes data
genes = pd.read_csv("benchmark/dataset/ASMdb/mock/mock_genes.csv")
print("\nGenes Data Head:")
print(genes.head())
print("\nGenes Columns:", genes.columns.tolist())
</execute>
<observation>ASM Sites Data Head:
   sample_id chrom      pos  asm_score
0  Sample_12  chr2  3690097      0.189
1  Sample_07  chr1  1182432      0.211
2  Sample_15  chr3  2863689      0.267
3  Sample_10  chr3  7342832      0.149
4  Sample_19  chr5  3948477      0.364

ASM Sites Columns: ['sample_id', 'chrom', 'pos', 'asm_score']

Genes Data Head:
     gene_id chrom    start      end strand
0  GENE_0001  chr4  6433388  6439778      +
1  GENE_0002  chr5  2244489  2262339      +
2  GENE_0003  chr3  9534682  9550105      +
3  GENE_0004  chr4  9638519  9655542      +
4  GENE_0005  chr5  4991505  4994938      -

Genes Columns: ['gene_id', 'chrom', 'start', 'end', 'strand']
</observation>
<execute>
#!BASH
# Create intermediate directory
mkdir -p /root/autodl-tmp/biomni_v20260208_tmp/doubao-seed-1-8/asmdb_annotate

# Create output directory
mkdir -p /root/autodl-tmp/biomni_v20260208_pred_results/doubao-seed-1-8/
</execute>
<observation></observation>
<execute>
# Process genes to include 3kb upstream region
genes['upstream_start'] = genes.apply(
    lambda row: row['start'] - 3000 if row['strand'] == '+' else row['end'],
    axis=1
)
genes['upstream_end'] = genes.apply(
    lambda row: row['start'] if row['strand'] == '+' else row['end'] + 3000,
    axis=1
)

# Create combined region start and end for overlap checking
genes['region_start'] = genes[['upstream_start', 'start']].min(axis=1)
genes['region_end'] = genes[['upstream_end', 'end']].max(axis=1)

# Save processed genes to intermediate file
processed_genes_path = "/root/autodl-tmp/biomni_v20260208_tmp/doubao-seed-1-8/asmdb_annotate/processed_genes.csv"
genes.to_csv(processed_genes_path, index=False)
print(f"Processed genes saved to {processed_genes_path}")
print("\nProcessed Genes Head:")
print(genes[['gene_id', 'chrom', 'region_start', 'region_end']].head())
</execute>
<observation>NameError("name 'genes' is not defined")</observation>
<execute>
import pandas as pd

# Re-read the data
asm_sites = pd.read_csv("benchmark/dataset/ASMdb/mock/mock_asm_sites.csv")
genes = pd.read_csv("benchmark/dataset/ASMdb/mock/mock_genes.csv")

# Process genes to include 3kb upstream region
genes['upstream_start'] = genes.apply(
    lambda row: row['start'] - 3000 if row['strand'] == '+' else row['end'],
    axis=1
)
genes['upstream_end'] = genes.apply(
    lambda row: row['start'] if row['strand'] == '+' else row['end'] + 3000,
    axis=1
)

# Create combined region start and end for overlap checking
genes['region_start'] = genes[['upstream_start', 'start']].min(axis=1)
genes['region_end'] = genes[['upstream_end', 'end']].max(axis=1)

# Save processed genes to intermediate file
processed_genes_path = "/root/autodl-tmp/biomni_v20260208_tmp/doubao-seed-1-8/asmdb_annotate/processed_genes.csv"
genes.to_csv(processed_genes_path, index=False)
print(f"Processed genes saved to {processed_genes_path}")
print("\nProcessed Genes Head:")
print(genes[['gene_id', 'chrom', 'region_start', 'region_end']].head())
</execute>
<observation>Processed genes saved to /root/autodl-tmp/biomni_v20260208_tmp/doubao-seed-1-8/asmdb_annotate/processed_genes.csv

Processed Genes Head:
     gene_id chrom  region_start  region_end
0  GENE_0001  chr4       6430388     6439778
1  GENE_0002  chr5       2241489     2262339
2  GENE_0003  chr3       9531682     9550105
3  GENE_0004  chr4       9635519     9655542
4  GENE_0005  chr5       4991505     4997938
</observation>
<execute>
# Merge ASM sites with genes on chromosome
merged = pd.merge(asm_sites, genes, on='chrom', how='inner')

# Check if ASM site is within gene region (including 3kb upstream)
merged['is_overlap'] = merged['pos'].between(merged['region_start'], merged['region_end'])

# Filter only overlapping records
overlaps = merged[merged['is_overlap']]

# Save overlaps to intermediate file
overlaps_path = "/root/autodl-tmp/biomni_v20260208_tmp/doubao-seed-1-8/asmdb_annotate/asm_gene_overlaps.csv"
overlaps.to_csv(overlaps_path, index=False)
print(f"ASM-gene overlaps saved to {overlaps_path}")
print(f"\nTotal overlapping ASM-gene pairs: {len(overlaps)}")
print("\nOverlaps Head:")
print(overlaps[['sample_id', 'gene_id', 'chrom', 'pos', 'region_start', 'region_end']].head())
</execute>
<observation>NameError("name 'pd' is not defined")</observation>
<execute>
import pandas as pd

# Re-read the data
asm_sites = pd.read_csv("benchmark/dataset/ASMdb/mock/mock_asm_sites.csv")
genes = pd.read_csv("benchmark/dataset/ASMdb/mock/mock_genes.csv")

# Process genes to include 3kb upstream region
genes['upstream_start'] = genes.apply(
    lambda row: row['start'] - 3000 if row['strand'] == '+' else row['end'],
    axis=1
)
genes['upstream_end'] = genes.apply(
    lambda row: row['start'] if row['strand'] == '+' else row['end'] + 3000,
    axis=1
)

# Create combined region start and end for overlap checking
genes['region_start'] = genes[['upstream_start', 'start']].min(axis=1)
genes['region_end'] = genes[['upstream_end', 'end']].max(axis=1)

# Merge ASM sites with genes on chromosome
merged = pd.merge(asm_sites, genes, on='chrom', how='inner')

# Check if ASM site is within gene region (including 3kb upstream)
merged['is_overlap'] = merged['pos'].between(merged['region_start'], merged['region_end'])

# Filter only overlapping records
overlaps = merged[merged['is_overlap']]

# Save overlaps to intermediate file
overlaps_path = "/root/autodl-tmp/biomni_v20260208_tmp/doubao-seed-1-8/asmdb_annotate/asm_gene_overlaps.csv"
overlaps.to_csv(overlaps_path, index=False)
print(f"ASM-gene overlaps saved to {overlaps_path}")
print(f"\nTotal overlapping ASM-gene pairs: {len(overlaps)}")
print("\nOverlaps Head:")
print(overlaps[['sample_id', 'gene_id', 'chrom', 'pos', 'region_start', 'region_end']].head())
</execute>
<observation>ASM-gene overlaps saved to /root/autodl-tmp/biomni_v20260208_tmp/doubao-seed-1-8/asmdb_annotate/asm_gene_overlaps.csv

Total overlapping ASM-gene pairs: 5722

Overlaps Head:
     sample_id    gene_id chrom      pos  region_start  region_end
58   Sample_12  GENE_0272  chr2  3690097       3688086     3700752
342  Sample_07  GENE_0736  chr1  1182432       1171795     1188869
553  Sample_15  GENE_0804  chr3  2863689       2856274     2864926
694  Sample_10  GENE_0536  chr3  7342832       7341901     7353880
877  Sample_19  GENE_0467  chr5  3948477       3939441     3958801
</observation>
<execute>
# Get unique sample-gene pairs
unique_pairs = overlaps[['sample_id', 'gene_id']].drop_duplicates()

# Calculate frequency per gene (number of unique samples)
gene_frequency = unique_pairs.groupby('gene_id')['sample_id'].nunique().reset_index()
gene_frequency.columns = ['gene_id', 'frequency']

# Sort by frequency descending
gene_frequency_sorted = gene_frequency.sort_values(by='frequency', ascending=False)

# Get top 100 genes
top_100_genes = gene_frequency_sorted.head(100)

# Save to output file
output_path = "/root/autodl-tmp/biomni_v20260208_pred_results/doubao-seed-1-8/asmdb_annotate.csv"
top_100_genes.to_csv(output_path, index=False)

print(f"Top 100 ASM genes saved to {output_path}")
print("\nTop 10 Genes:")
print(top_100_genes.head(10))
</execute>
<observation>NameError("name 'overlaps' is not defined")</observation>
<execute>
import pandas as pd

# Re-read overlaps data
overlaps = pd.read_csv("/root/autodl-tmp/biomni_v20260208_tmp/doubao-seed-1-8/asmdb_annotate/asm_gene_overlaps.csv")

# Get unique sample-gene pairs
unique_pairs = overlaps[['sample_id', 'gene_id']].drop_duplicates()

# Calculate frequency per gene (number of unique samples)
gene_frequency = unique_pairs.groupby('gene_id')['sample_id'].nunique().reset_index()
gene_frequency.columns = ['gene_id', 'frequency']

# Sort by frequency descending
gene_frequency_sorted = gene_frequency.sort_values(by='frequency', ascending=False)

# Get top 100 genes
top_100_genes = gene_frequency_sorted.head(100)

# Save to output file
output_path = "/root/autodl-tmp/biomni_v20260208_pred_results/doubao-seed-1-8/asmdb_annotate.csv"
top_100_genes.to_csv(output_path, index=False)

print(f"Top 100 ASM genes saved to {output_path}")
print("\nTop 10 Genes:")
print(top_100_genes.head(10))
</execute>
<observation>Top 100 ASM genes saved to /root/autodl-tmp/biomni_v20260208_pred_results/doubao-seed-1-8/asmdb_annotate.csv

Top 10 Genes:
       gene_id  frequency
243  GENE_0683         20
200  GENE_0563         20
143  GENE_0413         20
207  GENE_0581         20
34   GENE_0085         20
86   GENE_0252         20
320  GENE_0899         20
327  GENE_0920         20
54   GENE_0159         19
53   GENE_0158         19
</observation>
<solution>
The top 100 genes with the highest Allele-Specific Methylation (ASM) frequency have been successfully identified and saved to `/root/autodl-tmp/biomni_v20260208_pred_results/doubao-seed-1-8/asmdb_annotate.csv`. 

The top 10 genes are:
1. GENE_0683 - 20 samples
2. GENE_0563 - 20 samples
3. GENE_0413 - 20 samples
4. GENE_0581 - 20 samples
5. GENE_0085 - 20 samples
6. GENE_0252 - 20 samples
7. GENE_0899 - 20 samples
8. GENE_0920 - 20 samples
9. GENE_0159 - 19 samples
10. GENE_0158 - 19 samples

All intermediate files are stored in `/root/autodl-tmp/biomni_v20260208_tmp/doubao-seed-1-8/asmdb_annotate/`.
</solution>