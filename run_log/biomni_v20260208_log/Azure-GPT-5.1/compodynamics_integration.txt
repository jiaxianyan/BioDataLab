Process the provided CDS sequences in `benchmark/dataset/CompoDynamics/GCF_009428885.1_ASM942888v1_cds_from_genomic.fna`. 

Filter out sequences that meet any of the following criteria: 1) length is not a multiple of 3; 2) does not start with an "ATG" codon; 3) does not end with a standard stop codon ("TAA", "TAG", or "TGA"); 4) contains an internal stop codon. 

Save the remaining valid sequences to `/root/biodatalab/log/biomni_v20260209_pred_results/OpenAI/Azure-GPT-5.1/compodynamics_integration.fna`.

All temp data should be save in `/root/biodatalab/log/biomni_v20260209_tmp/OpenAI/Azure-GPT-5.1/compodynamics_integration`.

<execute>
#!BASH
echo "Step 1: Planning the task and inspecting input file"

# Plan (checklist)
cat << 'PLAN'
1. [ ] Locate and inspect the input CDS FASTA file.
2. [ ] Implement filtering logic for CDS validity (length, start codon, stop codon, internal stops).
3. [ ] Apply filter to all sequences and write valid ones to the specified output file.
4. [ ] Save any intermediate/temp data under the required tmp directory.
5. [ ] Verify output statistics (counts before/after) and paths.
PLAN

echo
echo "Step 1: Locate and inspect the input CDS FASTA file"
INPUT_FILE="benchmark/dataset/CompoDynamics/GCF_009428885.1_ASM942888v1_cds_from_genomic.fna"
ls -l "$INPUT_FILE" || { echo "Input file not found"; exit 1; }
head -n 20 "$INPUT_FILE"

echo
echo "Step 2: Run Python script to filter CDS sequences"

python - << 'PYCODE'
import os
from pathlib import Path

print("Updated plan:")
print("1. [✓] Locate and inspect the input CDS FASTA file.")
print("2. [ ] Implement filtering logic for CDS validity (length, start codon, stop codon, internal stops).")
print("3. [ ] Apply filter to all sequences and write valid ones to the specified output file.")
print("4. [ ] Save any intermediate/temp data under the required tmp directory.")
print("5. [ ] Verify output statistics (counts before/after) and paths.\n")

from Bio import SeqIO

input_path = Path("benchmark/dataset/CompoDynamics/GCF_009428885.1_ASM942888v1_cds_from_genomic.fna")
output_path = Path("/root/biodatalab/log/biomni_v20260209_pred_results/OpenAI/Azure-GPT-5.1/compodynamics_integration.fna")
tmp_dir = Path("/root/biodatalab/log/biomni_v20260209_tmp/OpenAI/Azure-GPT-5.1/compodynamics_integration")

# Ensure directories exist
output_path.parent.mkdir(parents=True, exist_ok=True)
tmp_dir.mkdir(parents=True, exist_ok=True)

print("Implementing filtering logic...")
print("2. [✓] Implement filtering logic for CDS validity (length, start codon, stop codon, internal stops).\n")

# Helper function for CDS validity
def is_valid_cds(seq_str: str) -> bool:
    seq = seq_str.upper().replace("U", "T")
    # 1) length multiple of 3
    if len(seq) % 3 != 0:
        return False
    # 2) start codon ATG
    if not seq.startswith("ATG"):
        return False
    # 3) end with standard stop codon
    if seq[-3:] not in {"TAA", "TAG", "TGA"}:
        return False
    # 4) no internal stop codon (exclude terminal codon)
    internal = seq[:-3]
    stop_codons = {"TAA", "TAG", "TGA"}
    for i in range(0, len(internal), 3):
        codon = internal[i:i+3]
        if codon in stop_codons:
            return False
    return True

print("Reading input sequences and applying filter...")

total = 0
kept = 0
discarded = 0

# Temp files for logging/filter debug
tmp_stats = tmp_dir / "filter_stats.txt"
tmp_discard = tmp_dir / "discarded_ids.txt"

with open(output_path, "w") as out_handle, \
     open(tmp_stats, "w") as stats_handle, \
     open(tmp_discard, "w") as disc_handle:

    for record in SeqIO.parse(str(input_path), "fasta"):
        total += 1
        seq_str = str(record.seq)
        if is_valid_cds(seq_str):
            kept += 1
            SeqIO.write(record, out_handle, "fasta")
        else:
            discarded += 1
            disc_handle.write(f"{record.id}\n")

    stats_handle.write(f"Total sequences: {total}\n")
    stats_handle.write(f"Kept (valid CDS): {kept}\n")
    stats_handle.write(f"Discarded: {discarded}\n")

print("Filtering completed.")
print(f"Total sequences: {total}")
print(f"Kept (valid CDS): {kept}")
print(f"Discarded: {discarded}")
print(f"Valid sequences written to: {output_path}")
print(f"Temp stats file: {tmp_stats}")
print(f"Temp discarded IDs file: {tmp_discard}\n")

print("Updated plan after processing:")
print("1. [✓] Locate and inspect the input CDS FASTA file.")
print("2. [✓] Implement filtering logic for CDS validity (length, start codon, stop codon, internal stops).")
print("3. [✓] Apply filter to all sequences and write valid ones to the specified output file.")
print("4. [✓] Save any intermediate/temp data under the required tmp directory.")
print("5. [ ] Verify output statistics (counts before/after) and paths.")
PYCODE

echo
echo "Step 3: Verify output statistics and paths"
STATS_FILE="/root/biodatalab/log/biomni_v20260209_tmp/OpenAI/Azure-GPT-5.1/compodynamics_integration/filter_stats.txt"
OUTPUT_FILE="/root/biodatalab/log/biomni_v20260209_pred_results/OpenAI/Azure-GPT-5.1/compodynamics_integration.fna"

echo "Stats file:"
cat "$STATS_FILE"

echo
echo "Output file line count (for quick sanity check):"
wc -l "$OUTPUT_FILE"

echo
echo "Final plan status:"
cat << 'FINAL_PLAN'
1. [✓] Locate and inspect the input CDS FASTA file.
2. [✓] Implement filtering logic for CDS validity (length, start codon, stop codon, internal stops).
3. [✓] Apply filter to all sequences and write valid ones to the specified output file.
4. [✓] Save any intermediate/temp data under the required tmp directory.
5. [✓] Verify output statistics (counts before/after) and paths.
FINAL_PLAN
</execute>
<observation>Step 1: Planning the task and inspecting input file
1. [ ] Locate and inspect the input CDS FASTA file.
2. [ ] Implement filtering logic for CDS validity (length, start codon, stop codon, internal stops).
3. [ ] Apply filter to all sequences and write valid ones to the specified output file.
4. [ ] Save any intermediate/temp data under the required tmp directory.
5. [ ] Verify output statistics (counts before/after) and paths.

Step 1: Locate and inspect the input CDS FASTA file
-rw-r--r-- 1 root root 2602514 Feb  4 08:58 benchmark/dataset/CompoDynamics/GCF_009428885.1_ASM942888v1_cds_from_genomic.fna
>lcl|NZ_WHYS01000010.1_cds_WP_152943596.1_1 [gene=csx7] [locus_tag=GFB69_RS13170] [protein=type III CRISPR-associated RAMP protein Csx7] [protein_id=WP_152943596.1] [location=182..991] [gbkey=CDS]
TTGAGGAGAGTTGAAATAAAAGGAATAGTTAGGAACGTCTCTCCTCTGAGGATAGGGAATAGGGGTGTAGTTGACTTTAC
GTCAACTGCCGGCGTTCAATTATTAAAGAACAGCAGAGGAACCCCTTACATTCCAGGCTCTTCGTGGAAGGGAGTTTTCC
GCTCCACCGGCGAAGTAATAGCTAGGAAGAAAGGGTTAAGAGTATGCACTGGATTAACTGGAGACACTTGCGTTGATAAA
ATTCCAGAATTTCAAGAGCTTATAGAGAAGGACATCGAAAAGGCAAAGAAGGTATTCTGGGAAAAGACTTGTCTAAATTG
TAAAGTCTTTGGGGCACCTTCAGTTTTATCCTCTGTGTATTTCTTTGATTCCTATCCCTTCACTTATAAAATAGGAGTTA
AGACTATCATTGCAATAAGCAGGGAAAACGGCGCAGTTTCTAAGGGAGCTTTAGCTACTGCAGAGTACCTTGAGCCAAAC
TCAACTTTCTCATTCCTTCTCTTGGGTGAAAATATGCCAAATTACGCCATAGGTTATATTCTCTCAATAATGAAGGAAAT
CCATGACGGGCTTTCTCAGGTTGGAGGTTATAAGAGCAGGGGCTTCGGTTTCGTGAAATTTGATAAACTGGAGTTGAAAA
TTACTCATTACTCAGAGAAGAGCGGTTCCGGTTCATCACTTTTGCCTTTAGACGAACTTGACTCAAAGGTTGATTATACG
CAGGGTGAATTAAGCGGAGATGAATTCTTCAAGAAGAATTCCTCCCTCCTAGAGGTGTTTAATAATGCAAGGATTCAATA
CCCAATGTAA
>lcl|NZ_WHYS01000010.1_cds_WP_152943598.1_2 [locus_tag=GFB69_RS13175] [protein=RAMP superfamily CRISPR-associated protein] [protein_id=WP_152943598.1] [location=966..1763] [gbkey=CDS]
ATGCAAGGATTCAATACCCAATGTAAATCTGAACCCACTCCTAGAAATATAGGAGAAAAGAGGAGAGTTCACGTAAAGAT
TAGCGTAGTGTCTGAGTACTTTCACGTTTCGCAAAATCCTAAGCCGATGCCGTTAATAGAGGAAAAGAATGCAAACTCAA
TTATTTCCCAATTCCTACAGACTGGAAGAGCCAACGTTTTCGTTGAGAGGGACGCAGTCTATTTTACCAGAGTAGGGGAA
GATATAGTTATTCCAGCAAACACTGTTAGAGGGGCAGTAAGGAGTAGGCTTGAAGTGCTATTTGATTGCTCTTGTTATAA
TTCACTAGGTAATAGGCCTTCCGCATCCATCTCTAGAAAATATAAGGAAATATTCAAACCTAGAAGGAAGTACAGCGATG
ACCTAGAAAGAGAAGGCAAAGTTTGCCCTGTATGTAACGTTTTCGGCACTGCGGGTCTAGCTAGTAGGATAACTTTTACG
GACTTCAAATTAACAGCTGGCAAAGTGGACTACGTTAATGTCCAAGGTTATACTTACGAGGTTGCAACTAAGGGTTCAGT

Step 2: Run Python script to filter CDS sequences
Updated plan:
1. [✓] Locate and inspect the input CDS FASTA file.
2. [ ] Implement filtering logic for CDS validity (length, start codon, stop codon, internal stops).
3. [ ] Apply filter to all sequences and write valid ones to the specified output file.
4. [ ] Save any intermediate/temp data under the required tmp directory.
5. [ ] Verify output statistics (counts before/after) and paths.

Implementing filtering logic...
2. [✓] Implement filtering logic for CDS validity (length, start codon, stop codon, internal stops).

Reading input sequences and applying filter...
Filtering completed.
Total sequences: 2701
Kept (valid CDS): 1984
Discarded: 717
Valid sequences written to: /root/biodatalab/log/biomni_v20260209_pred_results/OpenAI/Azure-GPT-5.1/compodynamics_integration.fna
Temp stats file: /root/biodatalab/log/biomni_v20260209_tmp/OpenAI/Azure-GPT-5.1/compodynamics_integration/filter_stats.txt
Temp discarded IDs file: /root/biodatalab/log/biomni_v20260209_tmp/OpenAI/Azure-GPT-5.1/compodynamics_integration/discarded_ids.txt

Updated plan after processing:
1. [✓] Locate and inspect the input CDS FASTA file.
2. [✓] Implement filtering logic for CDS validity (length, start codon, stop codon, internal stops).
3. [✓] Apply filter to all sequences and write valid ones to the specified output file.
4. [✓] Save any intermediate/temp data under the required tmp directory.
5. [ ] Verify output statistics (counts before/after) and paths.

Step 3: Verify output statistics and paths
Stats file:
Total sequences: 2701
Kept (valid CDS): 1984
Discarded: 717

Output file line count (for quick sanity check):
28887 /root/biodatalab/log/biomni_v20260209_pred_results/OpenAI/Azure-GPT-5.1/compodynamics_integration.fna

Final plan status:
1. [✓] Locate and inspect the input CDS FASTA file.
2. [✓] Implement filtering logic for CDS validity (length, start codon, stop codon, internal stops).
3. [✓] Apply filter to all sequences and write valid ones to the specified output file.
4. [✓] Save any intermediate/temp data under the required tmp directory.
5. [✓] Verify output statistics (counts before/after) and paths.
</observation>
<solution>
1. [✓] Locate and inspect the input CDS FASTA file.
2. [✓] Implement filtering logic for CDS validity (length, start codon, stop codon, internal stops).
3. [✓] Apply filter to all sequences and write valid ones to the specified output file.
4. [✓] Save any intermediate/temp data under the required tmp directory.
5. [✓] Verify output statistics (counts before/after) and paths.

Processing summary:
- Input file: `benchmark/dataset/CompoDynamics/GCF_009428885.1_ASM942888v1_cds_from_genomic.fna`
- Total sequences read: 2701
- Valid CDS sequences kept: 1984
- Discarded sequences: 717

Filtering criteria applied:
1) Sequence length must be a multiple of 3.  
2) Sequence must start with `ATG`.  
3) Sequence must end with one of `TAA`, `TAG`, or `TGA`.  
4) No internal in-frame stop codons (`TAA`, `TAG`, `TGA`) are allowed anywhere except the terminal codon.

Outputs:
- Final filtered FASTA:
  - `/root/biodatalab/log/biomni_v20260209_pred_results/OpenAI/Azure-GPT-5.1/compodynamics_integration.fna`
  - Line count (sanity check): 28,887

Temporary data (as requested, all under the tmp directory):
- Filter statistics:
  - `/root/biodatalab/log/biomni_v20260209_tmp/OpenAI/Azure-GPT-5.1/compodynamics_integration/filter_stats.txt`
  - Contents:
    - `Total sequences: 2701`
    - `Kept (valid CDS): 1984`
    - `Discarded: 717`
- List of discarded sequence IDs:
  - `/root/biodatalab/log/biomni_v20260209_tmp/OpenAI/Azure-GPT-5.1/compodynamics_integration/discarded_ids.txt`

The requested filtered CDS FASTA has been generated at the specified location, and all intermediate data are stored under the required tmp path. </solution>