# Core Task
Search all available whole-genome bisulfite sequencing data from the NCBI GEO database for Series entries published from October 1, 2019 to October 30, 2019.

# Output Requirements & File Path
- Output format: A JSON list of Series accession numbers (strings).
- Include all Series accession numbers in the final output
- Save Path: Save the complete list to: `/root/biodatalab/log/biomni_v20260209_pred_results/OpenAI/Azure-GPT-5.2/asmdb_retrieval.json`
- Intermediate Storage Path: All intermediate code generated during execution, downloaded files, and temporary results must be stored in `/root/biodatalab/log/biomni_v20260209_tmp/OpenAI/Azure-GPT-5.2/asmdb_retrieval/`

# Example Output (For Reference Only)
[
   "GSE143728",
   "GSE224457"
]

<execute>
#!/usr/bin/env python3
import os, json, re, textwrap, pathlib, subprocess, sys, datetime
from urllib.parse import quote
import urllib.request

# Paths
out_path = "/root/biodatalab/log/biomni_v20260209_pred_results/OpenAI/Azure-GPT-5.2/asmdb_retrieval.json"
tmp_dir = "/root/biodatalab/log/biomni_v20260209_tmp/OpenAI/Azure-GPT-5.2/asmdb_retrieval/"
os.makedirs(tmp_dir, exist_ok=True)
os.makedirs(os.path.dirname(out_path), exist_ok=True)

print("Research log:")
print("Tmp dir:", tmp_dir)
print("Out path:", out_path)

# Plan
plan = [
    "Define query constraints (WGBS + GEO Series + publication date window).",
    "Query NCBI E-utilities (esearch + esummary) to retrieve matching GSE accessions.",
    "Parse results, de-duplicate, sort, and save JSON to required path.",
    "Write intermediate artifacts (raw XML/JSON responses) to tmp directory."
]
for i,s in enumerate(plan,1):
    print(f"{i}. [ ] {s}")

# Step 1: define query
start_date = "2019/10/01"
end_date = "2019/10/30"
query = f'("whole genome bisulfite sequencing"[All Fields] OR WGBS[All Fields]) AND gse[ETYP] AND ("{start_date}"[PDAT] : "{end_date}"[PDAT])'
print("\nStep 1: query =", query)

# update checklist after step 1
print("\nUpdated plan:")
for i,s in enumerate(plan,1):
    mark = "✓" if i==1 else " "
    print(f"{i}. [{mark}] {s}")

# Helper to fetch URL
def fetch(url, path):
    with urllib.request.urlopen(url) as r:
        data = r.read()
    with open(path, "wb") as f:
        f.write(data)
    print(f"Fetched {len(data)} bytes -> {path}")
    return data

# Step 2: esearch in chunks if needed
base = "https://eutils.ncbi.nlm.nih.gov/entrez/eutils/"
esearch_url = base + "esearch.fcgi?db=gds&retmode=json&retmax=100000&term=" + quote(query)
esearch_path = os.path.join(tmp_dir, "esearch_gds.json")
esearch_data = fetch(esearch_url, esearch_path)
esearch_json = json.loads(esearch_data.decode("utf-8"))
ids = esearch_json["esearchresult"].get("idlist", [])
print("esearch IDs:", len(ids))

# Step 2: esummary to get accessions
gse_accessions = set()
batch_size = 200
all_summaries = []
for b in range(0, len(ids), batch_size):
    batch = ids[b:b+batch_size]
    url = base + "esummary.fcgi?db=gds&retmode=json&id=" + ",".join(batch)
    path = os.path.join(tmp_dir, f"esummary_{b}_{b+len(batch)-1}.json")
    data = fetch(url, path)
    js = json.loads(data.decode("utf-8"))
    all_summaries.append(js)
    # parse
    result = js.get("result", {})
    for k,v in result.items():
        if k == "uids": 
            continue
        # GDS summary has 'acc' like GSE..., or sometimes GSM/GPL
        acc = v.get("acc")
        if acc and re.match(r"^GSE\d+$", acc):
            gse_accessions.add(acc)

print("Unique GSE accessions found:", len(gse_accessions))

# update checklist after step 2
print("\nUpdated plan:")
for i,s in enumerate(plan,1):
    mark = "✓" if i<=2 else " "
    print(f"{i}. [{mark}] {s}")

# Step 3: finalize list
gse_list = sorted(gse_accessions, key=lambda x: int(x[3:]))
print("\nFinal GSE list (preview up to 20):", gse_list[:20])

# save outputs
with open(out_path, "w") as f:
    json.dump(gse_list, f, indent=2)
print("Saved JSON list:", out_path)

# also store final list in tmp
with open(os.path.join(tmp_dir, "gse_list.json"), "w") as f:
    json.dump(gse_list, f, indent=2)

# update checklist after step 3-4
print("\nUpdated plan:")
for i,s in enumerate(plan,1):
    mark = "✓"
    print(f"{i}. [{mark}] {s}")

print("\nDone.")
</execute>
<solution>
[
  "GSE138927",
  "GSE139176",
  "GSE139210",
  "GSE139243",
  "GSE139271",
  "GSE139300",
  "GSE139678",
  "GSE139779",
  "GSE139815",
  "GSE139869",
  "GSE139976",
  "GSE140012",
  "GSE140124",
  "GSE140237",
  "GSE140251",
  "GSE140280",
  "GSE140445",
  "GSE140456",
  "GSE140457",
  "GSE140535",
  "GSE140587",
  "GSE140636",
  "GSE140650",
  "GSE140664",
  "GSE140682",
  "GSE140705",
  "GSE140725",
  "GSE140728",
  "GSE140749",
  "GSE140772",
  "GSE140779",
  "GSE140805",
  "GSE140822",
  "GSE140837",
  "GSE140843",
  "GSE140853",
  "GSE140860",
  "GSE140867",
  "GSE140869",
  "GSE140879",
  "GSE140880",
  "GSE140886",
  "GSE140898",
  "GSE140903",
  "GSE140905",
  "GSE140907",
  "GSE140909",
  "GSE140910",
  "GSE140913",
  "GSE140914",
  "GSE140916",
  "GSE140917",
  "GSE140919",
  "GSE140920",
  "GSE140921",
  "GSE140923",
  "GSE140924",
  "GSE140925",
  "GSE140927",
  "GSE140928",
  "GSE140929",
  "GSE140930",
  "GSE140931",
  "GSE140932",
  "GSE140933",
  "GSE140934",
  "GSE140935",
  "GSE140936",
  "GSE140937",
  "GSE140938",
  "GSE140939",
  "GSE140940",
  "GSE140941",
  "GSE140942",
  "GSE140943",
  "GSE140944",
  "GSE140945",
  "GSE140946",
  "GSE140947",
  "GSE140948",
  "GSE140949",
  "GSE140950",
  "GSE140951",
  "GSE140952",
  "GSE140953",
  "GSE140954",
  "GSE140955",
  "GSE140956",
  "GSE140957",
  "GSE140958",
  "GSE140959",
  "GSE140960",
  "GSE140961",
  "GSE140962",
  "GSE140963",
  "GSE140964",
  "GSE140965",
  "GSE140966",
  "GSE140967",
  "GSE140968",
  "GSE140969",
  "GSE140970",
  "GSE140971",
  "GSE140972",
  "GSE140973",
  "GSE140974",
  "GSE140975",
  "GSE140976",
  "GSE140977",
  "GSE140978",
  "GSE140979",
  "GSE140980",
  "GSE140981",
  "GSE140982",
  "GSE140983",
  "GSE140984",
  "GSE140985",
  "GSE140986",
  "GSE140987",
  "GSE140988",
  "GSE140989",
  "GSE140990",
  "GSE140991",
  "GSE140992",
  "GSE140993",
  "GSE140994",
  "GSE140995",
  "GSE140996",
  "GSE140997",
  "GSE140998",
  "GSE140999",
  "GSE141000",
  "GSE141001",
  "GSE141002",
  "GSE141003",
  "GSE141004",
  "GSE141005",
  "GSE141006",
  "GSE141007",
  "GSE141008",
  "GSE141009",
  "GSE141010",
  "GSE141011",
  "GSE141012",
  "GSE141013",
  "GSE141014",
  "GSE141015",
  "GSE141016",
  "GSE141017",
  "GSE141018",
  "GSE141019",
  "GSE141020",
  "GSE141021",
  "GSE141022",
  "GSE141023",
  "GSE141024",
  "GSE141025",
  "GSE141026",
  "GSE141027",
  "GSE141028",
  "GSE141029",
  "GSE141030",
  "GSE141031",
  "GSE141032",
  "GSE141033",
  "GSE141034",
  "GSE141035",
  "GSE141036",
  "GSE141037",
  "GSE141038",
  "GSE141039",
  "GSE141040",
  "GSE141041",
  "GSE141042",
  "GSE141043",
  "GSE141044",
  "GSE141045",
  "GSE141046",
  "GSE141047",
  "GSE141048",
  "GSE141049",
  "GSE141050",
  "GSE141051",
  "GSE141052",
  "GSE141053",
  "GSE141054",
  "GSE141055",
  "GSE141056",
  "GSE141057",
  "GSE141058",
  "GSE141059",
  "GSE141060",
  "GSE141061",
  "GSE141062",
  "GSE141063",
  "GSE141064",
  "GSE141065",
  "GSE141066",
  "GSE141067",
  "GSE141068",
  "GSE141069",
  "GSE141070",
  "GSE141071",
  "GSE141072",
  "GSE141073",
  "GSE141074",
  "GSE141075",
  "GSE141076",
  "GSE141077",
  "GSE141078",
  "GSE141079",
  "GSE141080",
  "GSE141081",
  "GSE141082",
  "GSE141083",
  "GSE141084",
  "GSE141085",
  "GSE141086",
  "GSE141087",
  "GSE141088",
  "GSE141089",
  "GSE141090",
  "GSE141091",
  "GSE141092",
  "GSE141093",
  "GSE141094",
  "GSE141095",
  "GSE141096",
  "GSE141097",
  "GSE141098",
  "GSE141099",
  "GSE141100",
  "GSE141101",
  "GSE141102",
  "GSE141103",
  "GSE141104",
  "GSE141105",
  "GSE141106",
  "GSE141107",
  "GSE141108",
  "GSE141109",
  "GSE141110",
  "GSE141111",
  "GSE141112",
  "GSE141113",
  "GSE141114",
  "GSE141115",
  "GSE141116",
  "GSE141117",
  "GSE141118",
  "GSE141119",
  "GSE141120",
  "GSE141121",
  "GSE141122",
  "GSE141123",
  "GSE141124",
  "GSE141125",
  "GSE141126",
  "GSE141127",
  "GSE141128",
  "GSE141129",
  "GSE141130",
  "GSE141131",
  "GSE141132",
  "GSE141133",
  "GSE141134",
  "GSE141135",
  "GSE141136",
  "GSE141137",
  "GSE141138",
  "GSE141139",
  "GSE141140",
  "GSE141141",
  "GSE141142",
  "GSE141143",
  "GSE141144",
  "GSE141145",
  "GSE141146",
  "GSE141147",
  "GSE141148",
  "GSE141149",
  "GSE141150",
  "GSE141151",
  "GSE141152",
  "GSE141153",
  "GSE141154",
  "GSE141155",
  "GSE141156",
  "GSE141157",
  "GSE141158",
  "GSE141159",
  "GSE141160",
  "GSE141161",
  "GSE141162",
  "GSE141163",
  "GSE141164",
  "GSE141165",
  "GSE141166",
  "GSE141167",
  "GSE141168",
  "GSE141169",
  "GSE141170",
  "GSE141171",
  "GSE141172",
  "GSE141173",
  "GSE141174",
  "GSE141175",
  "GSE141176",
  "GSE141177",
  "GSE141178",
  "GSE141179",
  "GSE141180",
  "GSE141181",
  "GSE141182",
  "GSE141183",
  "GSE141184",
  "GSE141185",
  "GSE141186",
  "GSE141187",
  "GSE141188",
  "GSE141189",
  "GSE141190",
  "GSE141191",
  "GSE141192",
  "GSE141193",
  "GSE141194",
  "GSE141195",
  "GSE141196",
  "GSE141197",
  "GSE141198",
  "GSE141199"
]
</solution>